---
title: Optimizing Social Distance Keeping in Indoor Environments via a Public Display
  Navigation Support System - Investigations with R
author: "Christian Terbeck (christian.terbeck@uni-muenster.de)"
date: "January 27, 2022"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

### Preparation

Use NLRX library.

```
library(nlrx)
```

Set NetLogo settings according to NLRX documentation

```
netlogopath <- file.path("C:/Program Files/NetLogo 6.1.0")
modelpath <- file.path("C:/Users/chris/github/master/model6-1.nlogo")
outpath <- file.path("C:/Users/chris/github/master/output/r")
```

Set nl object (NetLogo 6.1 is currently the highest supported version).

```
nl <- nl(nlversion = "6.1.0",
         nlpath = netlogopath,
         modelpath = modelpath,
         jvmmem = 1024)
```

Check if nl object can initialize without errors.

```
print(nl)
```

Set up the experiment based on the NetLogo model.

```
nl@experiment <- experiment(expname = "hospital",
                            outpath = outpath,
                            repetition = 1,
                            tickmetrics = "false",
                            idsetup = "setup",
                            idgo = "simulate",
                            runtime = 25000,
                            evalticks = seq(5000),
                            metrics = c("time", "round overall-contacts / 2", "round visitor-contacts / 2", "round visitor-staff-contacts / 2", "round staff-contacts / 2", "round unique-contacts / 2", "round critical-contacts / 2", "overall-contact-time / overall-contacts", "contact-distance / contact-distance-values"),
                            variables = list("static-signage-rate"= list(values = c(0, 0.25, 0.5, 0.75, 1))),
                            constants = list("scenario" = "\"hospital\"",
                                             "dt" = 1,
                                             "V0" = 1,
                                             "A" = 1,
                                             "D" = 2,
                                             "Tr" = 1,
                                             "initial-number-of-visitors" = 0,
                                             "staff-members-per-level" = 3,
                                             "staff-switches-levels?" = "false",
                                             "spawn-rate" = 180,
                                             "mean-treatment-time" = 10,
                                             "mean-visiting-time" = 30,
                                             "max-visiting-time" = 60,
                                             "max-capacity" = 120,
                                             "area-of-awareness" = 10,
                                             "angle-of-awareness" = 15,
                                             "use-stop-feature?" = "true",
                                             "mean-waiting-tolerance" = 600,
                                             "show-areas-of-awareness?" = "false",
                                             "use-static-signage?" = "false",
                                             "consider-people-at-adjacent-displays?" = "true",
                                             "force-all-visitors-to-stick-to-one-ways?" = "true",
                                             "scan-movement-directions?" = "false",
                                             "contact-radius" = 1.5,
                                             "critical-period" = 15,
                                             "contact-tolerance" = 1,
                                             "show-circles?" = "false",
                                             "show-paths?" = "false",
                                             "show-walking-paths?" = "false",
                                             "show-logs?" = "false",
                                             "show-contacts?" = "false",
                                             "show-labels?" = "false",
                                             "enable-gis-extension?" = "false",
                                             "write-output?" = "false",
                                             "output-steps" = 1000,
                                             "stop-at-ticks" = 0,
                                             "gate-open-period" = 0,
                                             "mean-passenger-number" = 0))
```

Check if all variables and constants are assigned correctly:

```
eval_variables_constants(nl)
```

Set up simulation design:
  
```
nl@simdesign <- simdesign_distinct(nl = nl, nseeds = 4)
```

Check for errors again:
  
```
print(nl)
```

### Running Simulation(s)

Compute results:
  
```
results <- run_nl_all(nl = nl)
```

Setting up experiment for sensitivity analysis:


```
nl@experiment <- experiment(expname = "hospital",
                            outpath = outpath,
                            repetition = 1,
                            tickmetrics = "false",
                            idsetup = "setup",
                            idgo = "simulate",
                            runtime = 25000,
                            evalticks = seq(5000),
                            metrics = c("time", "round overall-contacts / 2", "round visitor-contacts / 2", "round visitor-staff-contacts / 2", "round staff-contacts / 2", "round unique-contacts / 2", "round critical-contacts / 2", "overall-contact-time / overall-contacts", "contact-distance / contact-distance-values"),
                            variables = list("static-signage-rate" = list(min = 0, max = 1, qfun = "qunif")),
                            constants = list("scenario" = "\"hospital\"",
                                             "dt" = 1,
                                             "V0" = 1,
                                             "A" = 1,
                                             "D" = 2,
                                             "Tr" = 1,
                                             "initial-number-of-visitors" = 0,
                                             "staff-members-per-level" = 3,
                                             "staff-switches-levels?" = "false",
                                             "spawn-rate" = 180,
                                             "mean-treatment-time" = 10,
                                             "mean-visiting-time" = 30,
                                             "max-visiting-time" = 60,
                                             "max-capacity" = 120,
                                             "area-of-awareness" = 10,
                                             "angle-of-awareness" = 15,
                                             "use-stop-feature?" = "true",
                                             "mean-waiting-tolerance" = 600,
                                             "show-areas-of-awareness?" = "false",
                                             "use-static-signage?" = "false",
                                             "consider-people-at-adjacent-displays?" = "true",
                                             "force-all-visitors-to-stick-to-one-ways?" = "true",
                                             "scan-movement-directions?" = "false",
                                             "contact-radius" = 1.5,
                                             "critical-period" = 15,
                                             "contact-tolerance" = 1,
                                             "show-circles?" = "false",
                                             "show-paths?" = "false",
                                             "show-walking-paths?" = "false",
                                             "show-logs?" = "false",
                                             "show-contacts?" = "false",
                                             "show-labels?" = "false",
                                             "enable-gis-extension?" = "false",
                                             "write-output?" = "false",
                                             "output-steps" = 1000,
                                             "stop-at-ticks" = 0,
                                             "gate-open-period" = 0,
                                             "mean-passenger-number" = 0))
```

Latin hypercube sampling (sensitivity analysis):

```
nl@simdesign <- simdesign_lhs(nl=nl,
                              samples=5,
                              nseeds=5,
                              precision=3)
```

Check for errors again:

```
print(nl)
```

### Running Simulation(s)

Compute results:

```
results <- run_nl_all(nl = nl)
```

### Plot results

```
plot(results$`static-signage-rate`, results$`round overall-contacts / 2`,
     xlab="Static signage rate (%)",
     ylab="Contacts",
     main="Overall contacts")
```

boxplot:

```
boxplot(results$`round overall-contacts / 2`~results$`static-signage-rate`,
     xlab="Static signage rate (%)",
     ylab="Contacts",
     main="Overall contacts")
```

### Evaluation

Attach simulation, write output and analyze data:

```
setsim(nl, "simoutput") <- results
write_simoutput(nl)
analyze_nl(nl)
```